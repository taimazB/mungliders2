var field,fields,wind,pngWidth,pngHeight,lastModelDateTime,mapWidth,mapHeight,bnds,varMin,varMax,varMinOrg,varMaxOrg,varPalette,currentsMinOrg,currentsMaxOrg,currentsMin,currentsMax,sstMinOrg,sstMaxOrg,sstMin,sstMax,swhMinOrg,swhMaxOrg,swhMin,swhMax,seaiceMinOrg,seaiceMaxOrg,seaiceMin,seaiceMax,reqAnimID,initLoad=!0,speed=[],direction=[],imgGlobal=new Image,imgBathymetry=new Image,R=6378137,isAnimation=!0,isMouseInfo=!1,infoWindowWidth=100,infoWindowHeight=50,bathymetryOpacityValue=50;const cnvBathymetry=document.getElementById("cnvBathymetry");var cnvBathymetryTmp=document.createElement("canvas");const cnvGL=document.getElementById("cnvAnim"),cnvArrows=d3.select("#cnvArrows").node(),cnvContourf=d3.select("#cnvContourf").node();var cnvTmp=document.createElement("canvas");const ctxBathymetry=cnvBathymetry.getContext("2d");var ctxBathymetryTmp=cnvBathymetryTmp.getContext("2d");const ctxGL=cnvGL.getContext("webgl",{antialiasing:!1}),ctxArrow=cnvArrows.getContext("2d"),ctxContourf=cnvContourf.getContext("2d");var colorPicker,idPlayTime,ctxTmp=cnvTmp.getContext("2d");function zeroPad(t,e){var a=Math.abs(t),n=Math.max(0,e-Math.floor(a).toString().length),r=Math.pow(10,n).toString().substr(1);return t<0&&(r="-"+(r=Math.pow(10,n-1).toString().substr(1))),r+a}function lon2x(t){return R*t*Math.PI/180}function lat2y(t){return R*Math.log(Math.sin(Math.PI/4+t*Math.PI/180/2)/Math.cos(Math.PI/4+t*Math.PI/180/2))}function num2latlon(t,e){var a;return"lat"==e?a=t>=0?t.toFixed(3)+" &deg;N":-t.toFixed(3)+" &deg;S":"lon"==e&&(a=t>=0?t.toFixed(3)+" &deg;E":-t.toFixed(3)+" &deg;W"),a}function btnsActivate(){$(".ui.button").on("click",function(){$(this).addClass("active").siblings().removeClass("active")})}function getJSON(t,e){const a=new XMLHttpRequest;a.responseType="json",a.open("get",t,!0),a.onload=function(){if(!(a.status>=200&&a.status<300))throw new Error(a.statusText);e(a.response)},a.send()}function fieldLongName(t){switch(t){case"SST":return"Sea Surface Temperature";case"SWH":return"Sea Wave Height";default:return""}}function colorPaletteRainbow(t){var e=[[102,0,102],[0,153,255],[51,204,51],[255,255,0],[255,153,0],[255,51,0],[255,204,255]],a=_.range(e.length).map(t=>t/(e.length-1));if(t<a[0])return e[0];if(!(t<a[a.length-1]))return e[e.length-1];for(var n=1;n<a.length;n++)if(t<=a[n]){var r=(t-a[n-1])/(a[n]-a[n-1]);return[(1-r)*e[n-1][0]+r*e[n][0],(1-r)*e[n-1][1]+r*e[n][1],(1-r)*e[n-1][2]+r*e[n][2]]}}function colorPaletteBlue(t){var e=[[0,153,255],[255,255,255]],a=_.range(e.length).map(t=>t/(e.length-1));if(t<a[0])return e[0];if(!(t<a[a.length-1]))return e[e.length-1];for(var n=1;n<a.length;n++)if(t<=a[n]){var r=(t-a[n-1])/(a[n]-a[n-1]);return[(1-r)*e[n-1][0]+r*e[n][0],(1-r)*e[n-1][1]+r*e[n][1],(1-r)*e[n-1][2]+r*e[n][2]]}}function adjustColorbar(t,e,a){$("#colorbar").css("background-image",`linear-gradient(to right, ${_.range(10).map(t=>"rgb("+a(t/10)+")").join()}`),$("#lbColorbar0").html(t.toFixed(1)),$("#lbColorbar25").html((.75*t+.25*e).toFixed(1)),$("#lbColorbar50").html((.5*t+.5*e).toFixed(1)),$("#lbColorbar75").html((.25*t+.75*e).toFixed(1)),$("#lbColorbar100").html(e.toFixed(1))}function getAvailDateTimes(t,e,a){var n;return $.ajax({url:"/getAvailDateTimes",type:"POST",async:!1,data:{model:t,field:e,i:a},success:function(t,e,a){n=t},error:function(t,e,a){console.log(a)}}),n}function findClosestDateTime(t,e){var a=d3.minIndex(e.map(e=>Math.abs(e.diff(t,"minute"))));return{index:a,dateTime:e[a]}}function init_btnFields(){$("#btnsField").empty(),[...new Set(fields.map(t=>t.field))].forEach((t,e)=>{$("#btnsField").append(`<button id="btn${t}" class="ui button" data-content="${fieldLongName(t)}">${t}</button>`),$(`#btn${t}`).on("click",function(){$(".canvas").css("display","none"),init_btnModels(t),unhideCanvas(),addSettings(t);try{addRemoveMouseInfo()}catch(t){}})}),btnsActivate(),$(`#btn${field.field}`).click()}function init_btnModels(t){function e(){$("#btnsTime").find("button").addClass("disabled");var t=null,e=field.dateTimes.filter(t=>t.format("YMMDD")==lastModelDateTime.format("YMMDD"));e.map(e=>{lastModelDateTime.format("HH")==e.format("HH")&&(t=e.format("HH")),$(`#hr${e.format("HH")}`).removeClass("disabled")}),t?$(`#hr${t}`).click():$(`#hr${e[0].format("HH")}`).click()}$("#btnsModel").empty(),fields.filter(e=>e.field==t).forEach((a,n)=>{$("#btnsModel").append(`<button id="btn${a.model}" class="ui button">${a.model}</button>`),$(`#btn${a.model}`).on("click",function(){field=fields.filter(e=>e.field==t&&e.model==a.model)[0],init_ddDepths(),function(){lastModelDateTime<field.dateTimes[0]&&(lastModelDateTime=field.dateTimes[0]);lastModelDateTime>field.dateTimes[field.dateTimes.length-1]&&(lastModelDateTime=field.dateTimes[field.dateTimes.length-1]);var t=field.dateTimes[0].toDate().getUTCFullYear(),a=field.dateTimes[0].toDate().getUTCMonth(),n=field.dateTimes[0].toDate().getUTCDate(),r=field.dateTimes[field.dateTimes.length-1].toDate().getUTCFullYear(),i=field.dateTimes[field.dateTimes.length-1].toDate().getUTCMonth(),o=field.dateTimes[field.dateTimes.length-1].toDate().getUTCDate(),l=lastModelDateTime.toDate().getUTCFullYear(),s=lastModelDateTime.toDate().getUTCMonth(),d=lastModelDateTime.toDate().getUTCDate();$(".datepicker").datepicker({format:"M, dd",maxViewMode:1,todayBtn:"linked",todayHighlight:!0}).datepicker("setStartDate",new Date(t,a,n)).datepicker("setEndDate",new Date(r,i,o)).on("changeDate",t=>{lastModelDateTime=moment(lastModelDateTime).set("month",t.date.getMonth()),lastModelDateTime=moment(lastModelDateTime).set("date",t.date.getDate()),e()}).datepicker("update",new Date(l,s,d)),e()}()})}),btnsActivate(),$(`#btn${fields.filter(e=>e.field==t)[0].model}`).click()}function init_ddDepths(){$("#ddDepth").addClass("disabled"),field.depths&&($("#ddDepth").removeClass("disabled"),field.depth=field.depths[0],$("#ddDepth").dropdown({values:fields.filter(t=>t.field==field.field&&t.model==field.model)[0].depths.map((t,e)=>({name:t.text,value:e}))}).dropdown("set selected",field.depth.text).dropdown("setting","onChange",t=>{field.depth=field.depths[t],draw({init:!0})}))}function playTime(){var t=field.dateTimes.findIndex(t=>t.format("YMMDD_HH")==lastModelDateTime.format("YMMDD_HH"));$("#btnPlayTime i").hasClass("play")?($("#btnPlayTime i").removeClass("play"),$("#btnPlayTime i").addClass("pause"),$("#btnPlayTime").attr("data-content","Stop"),idPlayTime=setInterval(()=>{if(++t<field.dateTimes.length){var e=lastModelDateTime;if((lastModelDateTime=field.dateTimes[t]).toDate().getUTCDate()!=e.toDate().getUTCDate()){var a=lastModelDateTime.toDate().getUTCFullYear(),n=lastModelDateTime.toDate().getUTCMonth(),r=lastModelDateTime.toDate().getUTCDate();$(".datepicker").datepicker("setDate",new Date(a,n,r)).datepicker("update",new Date(a,n,r))}$(`#hr${lastModelDateTime.format("HH")}`).hasClass("disabled")||$(`#hr${lastModelDateTime.format("HH")}`).click()}else $("#btnPlayTime i").removeClass("pause"),$("#btnPlayTime i").addClass("play"),$("#btnPlayTime").attr("data-content","Play"),clearInterval(idPlayTime)},1e3)):($("#btnPlayTime i").removeClass("pause"),$("#btnPlayTime i").addClass("play"),$("#btnPlayTime").attr("data-content","Play"),clearInterval(idPlayTime))}function toggleAnimation(){(isAnimation=!isAnimation)?($("#cnvArrows").css("display","none"),$("#cnvAnim").css("display","block"),$("#btnCurrentsAnimation i").removeClass("play"),$("#btnCurrentsAnimation i").addClass("pause"),$("#btnCurrentsAnimation").attr("data-content","Stop animation")):($("#cnvAnim").css("display","none"),$("#cnvArrows").css("display","block"),$("#btnCurrentsAnimation i").removeClass("pause"),$("#btnCurrentsAnimation i").addClass("play"),$("#btnCurrentsAnimation").attr("data-content","Start animation")),draw({init:!1})}function toggleMouseInfo(){isMouseInfo=!isMouseInfo,addRemoveMouseInfo()}function addRemoveMouseInfo(){if(isMouseInfo){switch($("#infoWindow").css("display","block"),$("#infoWindow").width(infoWindowWidth),$("#infoWindow").empty(),field.field){case"Currents":$("#infoWindow").append('<div id="infoSpeed" style="width:100%; height:50%; text-align:center"></div>'),$("#infoWindow").append('<div id="infoDirection" style="width:100%; height:50%; text-align:center"></div>');break;case"SST":case"SWH":case"Seaice":$("#infoWindow").append('<div id="infoContourf" style="width:100%; height:100%; text-align:center"></div>')}$("#infoWindow").append('<div class="ui divider"></div>'),$("#infoWindow").append('<div id="infoBathymetry" style="width:100%; height:50%; text-align:center"></div>'),map.on("mousemove",showInfo),$("#btnMouseInfo").addClass("active"),$("#btnMouseInfo").attr("data-content","Hide data on map")}else $("#infoWindow").css("display","none"),map.off("mousemove",showInfo),$("#btnMouseInfo").removeClass("active"),$("#btnMouseInfo").attr("data-content","Show data on map")}function unhideCanvas(){switch(field.field){case"Currents":isAnimation?$("#cnvAnim").css("display","block"):$("#cnvArrows").css("display","block");break;case"SST":case"SWH":case"Seaice":$("#cnvContourf").css("display","block")}}function addSettings(t){switch($("#settingsModel").empty(),$("#settingsModel").append(`\n            <button id="btnMouseInfo" class="ui icon mini circular toggle button m-2 ${isMouseInfo?"active":null}" data-content="${isMouseInfo?"Hide data on map":"Show data on map"}"">\n              <i class="mouse pointer icon"></i>\n            </button>\n\n            <input id="bathymetryOpacity" class="m-2" type="text"/>\n            `),$("#btnMouseInfo").on("click",toggleMouseInfo),$("#bathymetryOpacity").slider({tooltip_position:"left",orientation:"vertical",min:0,max:100,value:bathymetryOpacityValue,step:10,reversed:!0,formatter:t=>`Bathymetry opacity: ${t}%`}).on("change",t=>{bathymetryOpacityValue=t.value.newValue,$("#cnvBathymetry").css("opacity",t.value.newValue/100),$(".canvas").css("opacity",1-t.value.newValue/100)}),t){case"Currents":$("#settingsModel").append(`\n            <button id="btnCurrentsAnimation" class="ui icon mini circular button m-2" data-content="${isAnimation?"Stop animation":"Start animation"}">\n              <i class="${isAnimation?"pause":"play"} icon"></i>\n            </button>\n            `),$("#btnCurrentsAnimation").on("click",toggleAnimation)}$("button").popup()}function showInfo(t){var e=ctxTmp.getImageData(t.point.x,t.point.y,1,1).data,a=ctxBathymetryTmp.getImageData(t.point.x,t.point.y,1,1).data,n=t.originalEvent.clientX+10;t.point.x+infoWindowWidth+10>mapWidth&&(n-=infoWindowWidth+10);var r=t.originalEvent.clientY+10;switch(t.point.y+infoWindowHeight+10>mapHeight&&(r-=infoWindowHeight+10),$("#infoWindow").offset({top:r,left:n}),field.field){case"Currents":u=6*e[0]/255-3,v=6*e[1]/255-3;var i=Math.sqrt(u**2+v**2);Math.sqrt(u**2+v**2);var o=180*Math.atan2(v,u)/Math.PI;o=o<0?o+360:o,i>.017?($("#infoWindow").css("display","block"),$("#infoSpeed").html(i.toFixed(3)+" <sup>m</sup>&frasl;<sub>s</sub>"),$("#infoDirection").html(o.toFixed(0)+" &deg;")):$("#infoWindow").css("display","none");break;case"SST":(l=e[0]/255*(varMaxOrg-varMinOrg)+varMinOrg)>=-1.8?($("#infoWindow").css("display","block"),$("#infoContourf").html(l.toFixed(1)+" &deg;C")):$("#infoWindow").css("display","none");break;case"SWH":(l=e[0]/255*(varMaxOrg-varMinOrg)+varMinOrg)>=-1.8?($("#infoWindow").css("display","block"),$("#infoContourf").html(l.toFixed(1)+" m")):$("#infoWindow").css("display","none");break;case"Seaice":var l;(l=e[0]/255*(varMaxOrg-varMinOrg)+varMinOrg)>=-1.8?($("#infoWindow").css("display","block"),$("#infoContourf").html(l.toFixed(1)+" %")):$("#infoWindow").css("display","none")}$("#infoBathymetry").html(50*-a[0]+" m")}function resetCurrentsMinMax(){currentsMin=currentsMinOrg,currentsMax=currentsMaxOrg}function resetSSTminMax(){sstMin=sstMinOrg,sstMax=sstMaxOrg}function resetSWHminMax(){swhMin=swhMinOrg,swhMax=swhMaxOrg}function resetSeaiceMinMax(){seaiceMin=seaiceMinOrg,seaiceMax=seaiceMaxOrg}function initateColorPicker(){colorPicker=new iro.ColorPicker("#colorPicker",{layout:[{component:iro.ui.Wheel,options:{wheelLightness:!0,wheelAngle:0,wheelDirection:"anticlockwise",width:100}}]})}function currentInit(){varMin=currentsMin,varMax=currentsMax,varMinOrg=currentsMinOrg,varMaxOrg=currentsMaxOrg,varPalette=colorPaletteRainbow,imgGlobal.src=`models/${field.model}/${field.field}/jpg/${field.model}_${field.field}_${lastModelDateTime.format("YYYYMMDD_HH")}_${field.depth.name}.jpg`,imgGlobal.onload=(()=>{var t=imgGlobal.naturalHeight*(1-(lat2y(bnds._ne.lat)+lat2y(80))/(2*lat2y(80))),e=imgGlobal.naturalHeight*(1-(lat2y(bnds._sw.lat)+lat2y(80))/(2*lat2y(80))),a=imgGlobal.naturalWidth*(bnds._sw.lng+180)/360,n=imgGlobal.naturalWidth*(bnds._ne.lng+180)/360-a,r=e-t;if(cnvTmp.width=mapWidth,cnvTmp.height=mapHeight,(ctxTmp=cnvTmp.getContext("2d")).drawImage(imgGlobal,a,t,n,r,0,0,cnvTmp.width,cnvTmp.height),adjustColorbar(0,varMax,varPalette),isAnimation){var i=new Image;i.src=cnvTmp.toDataURL(),animateArrows(i)}else staticArrows(ctxTmp)})}function animateArrows(t){(wind=window.wind=new WindGL(ctxGL)).numParticles=5e4;var e=.98;!function t(){wind.windData&&wind.draw(e),reqAnimID=requestAnimationFrame(t)}(),getJSON(`models/${field.model}/${field.field}/${field.model}_${field.field}.json`,function(e){e.varMin=currentsMin,e.varMax=currentsMax,e.image=t,wind.setWind(e)})}function staticArrows(t){var e,a,n=document.createElement("custom"),r=d3.select(n),i=[];switch(map.getZoom()){case 3:e=5;break;case 4:e=7;break;case 5:e=9;break;case 6:e=12;break;case 7:e=15;break;case 8:e=19;break;case 9:e=23;break;default:e=10}for(var o=0;o<=mapWidth;o+=e)for(var l=0;l<=mapHeight;l+=e){[s,d]=t.getImageData(o,l,1,1).data;var s=s/255*(varMax-varMin)+varMin,d=-(d/255*(varMax-varMin)+varMin),c=Math.sqrt(s**2+d**2);i.push({x:o,y:l,u:s,v:d,speed:c,direction:Math.atan2(d,s)})}a=r.selectAll("custom").data(i),allRects=a.enter().append("custom").attr("class","path"),a.merge(allRects).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("u",t=>t.u).attr("v",t=>t.v).attr("speed",t=>t.speed).attr("direction",t=>t.direction).attr("color",t=>`rgb(${varPalette(t.speed/currentsMax).join()})`),a.exit().remove(),ctxArrow.clearRect(0,0,mapWidth,mapHeight),r.selectAll("custom.path").each(function(t,e){var a=d3.select(this),n=parseFloat(a.attr("x")),r=parseFloat(a.attr("y")),i=parseFloat(a.attr("u")),o=parseFloat(a.attr("v")),l=parseFloat(a.attr("speed")),s=parseFloat(a.attr("direction"));ctxArrow.beginPath(),ctxArrow.moveTo(n,r),ctxArrow.lineTo(n+3*l*Math.cos(s+8/12*Math.PI),r+3*l*Math.sin(s+8/12*Math.PI)),ctxArrow.lineTo(n+9*i,r+9*o),ctxArrow.lineTo(n+3*l*Math.cos(s-8/12*Math.PI),r+3*l*Math.sin(s-8/12*Math.PI)),ctxArrow.lineTo(n,r),ctxArrow.fillStyle=a.attr("color"),ctxArrow.fill(),ctxArrow.closePath()})}function contourfInit(){switch(field.field){case"SST":varMin=sstMin,varMax=sstMax,varMinOrg=sstMinOrg,varMaxOrg=sstMaxOrg,varPalette=colorPaletteRainbow;break;case"SWH":varMin=swhMin,varMax=swhMax,varMinOrg=swhMinOrg,varMaxOrg=swhMaxOrg,varPalette=colorPaletteRainbow;break;case"Seaice":varMin=seaiceMin,varMax=seaiceMax,varMinOrg=seaiceMinOrg,varMaxOrg=seaiceMaxOrg,varPalette=colorPaletteBlue}$("#cnvContourf").css("display","block"),imgGlobal.src=`models/${field.model}/${field.field}/jpg/${field.model}_${field.field}_${lastModelDateTime.format("YYYYMMDD_HH")}.jpg`,imgGlobal.onload=(()=>{var t=imgGlobal.naturalHeight*(1-(lat2y(bnds._ne.lat)+lat2y(80))/(2*lat2y(80))),e=imgGlobal.naturalHeight*(1-(lat2y(bnds._sw.lat)+lat2y(80))/(2*lat2y(80))),a=imgGlobal.naturalWidth*(bnds._sw.lng+180)/360,n=imgGlobal.naturalWidth*(bnds._ne.lng+180)/360-a,r=e-t;cnvTmp.width=mapWidth,cnvTmp.height=mapHeight,(ctxTmp=cnvTmp.getContext("2d")).drawImage(imgGlobal,a,t,n,r,0,0,cnvTmp.width,cnvTmp.height),imageData=ctxTmp.getImageData(0,0,mapWidth,mapHeight);const i=imageData.data;adjustColorbar(varMin,varMax,varPalette);for(var o=0;o<i.length;o+=4){var l=varPalette((i[o]/255-(varMin-varMinOrg)/(varMaxOrg-varMinOrg))*(varMaxOrg-varMinOrg)/(varMax-varMin));i[o]=l[0],i[o+1]=l[1],i[o+2]=l[2]}ctxContourf.putImageData(imageData,0,0)})}function contourfMove(){var t=imgGlobal.naturalHeight*(1-(lat2y(bnds._ne.lat)+lat2y(80))/(2*lat2y(80))),e=imgGlobal.naturalHeight*(1-(lat2y(bnds._sw.lat)+lat2y(80))/(2*lat2y(80))),a=imgGlobal.naturalWidth*(bnds._sw.lng+180)/360,n=imgGlobal.naturalWidth*(bnds._ne.lng+180)/360-a,r=e-t;cnvTmp.width=mapWidth,cnvTmp.height=mapHeight,(ctxTmp=cnvTmp.getContext("2d")).drawImage(imgGlobal,a,t,n,r,0,0,cnvTmp.width,cnvTmp.height),imageData=ctxTmp.getImageData(0,0,mapWidth,mapHeight);for(var i=imageData.data,o=0;o<i.length;o+=4){var l=varPalette((i[o]/255-(varMin-varMinOrg)/(varMaxOrg-varMinOrg))*(varMaxOrg-varMinOrg)/(varMax-varMin));i[o]=l[0],i[o+1]=l[1],i[o+2]=l[2]}ctxContourf.putImageData(imageData,0,0)}$("#inputWeight").slider({tooltip:"always",tooltip_position:"bottom"}),$("#inputWeight").on("slide",function(t){PPweight=t.value,$("#weightValue").text(PPweight)}),$("#inputWeight").on("change",function(t){PPweight=t.value.newValue,$("#weightValue").text(PPweight)}),$(".tabButtons").on("click",t=>{switch($(".tabButtons").removeClass("active"),$(".tabContent").css("display","none"),t.target.name){case"tabModels":$("#tabModels").css("display","block");break;case"tabPathPlanning":$("#tabPathPlanning").css("display","block"),initiatePathPlanning();break;case"tabMissionsArchieve":$("#tabMissionsArchieve").css("display","block");break;case"tabSettings":$("#tabSettings").css("display","block")}}),$(".ui .accordion").accordion({selector:{trigger:".title .dropdown.icon"}}),$(".ui.sidebar").sidebar("setting","dimPage",!1).sidebar("setting","closable",!1),fields=[{field:"Currents",model:"HYCOM",depths:[{name:"0000-0010",text:"Surface (0-10 m)"},{name:"0050-20000",text:"Bottom (below 50 m)"},{name:"0010-0050",text:"10 - 50 m"},{name:"0050-0100",text:"50 - 100 m"},{name:"0100-0200",text:"100 - 200 m"},{name:"0200-0500",text:"200 - 500 m"},{name:"0500-1000",text:"500 m - 1 km"},{name:"1000-1500",text:"1 - 1.5 km"},{name:"1500-2000",text:"1.5 - 2 km"}],depth:null,latestRun:null,dateTimes:getAvailDateTimes("HYCOM","Currents",2).map(t=>moment.utc(t,"YYYYMMDD_HH")),dateTime:null},{field:"Currents",model:"RIOPS",depths:[{name:"0000-0010",text:"Surface (0-10 m)"},{name:"0050-20000",text:"Bottom (below 50 m)"},{name:"0010-0050",text:"10 - 50 m"},{name:"0050-0100",text:"50 - 100 m"},{name:"0100-0200",text:"100 - 200 m"},{name:"0200-0500",text:"200 - 500 m"},{name:"0500-1000",text:"500 m - 1 km"},{name:"1000-1500",text:"1 - 1.5 km"},{name:"1500-2000",text:"1.5 - 2 km"}],depth:null,latestRun:null,dateTimes:getAvailDateTimes("RIOPS","Currents",2).map(t=>moment.utc(t,"YYYYMMDD_HH")),dateTime:null},{field:"SST",model:"JPLMUR41",depths:null,depth:null,latestRun:null,dateTimes:getAvailDateTimes("JPLMUR41","SST",2).map(t=>moment.utc(t,"YYYYMMDD_HH")),dateTime:null},{field:"SWH",model:"CMC",depths:null,depth:null,latestRun:null,dateTimes:getAvailDateTimes("CMC","SWH",2).map(t=>moment.utc(t,"YYYYMMDD_HH")),dateTime:null},{field:"Seaice",model:"CMC",depths:null,depth:null,latestRun:null,dateTimes:getAvailDateTimes("CMC","Seaice",2).map(t=>moment.utc(t,"YYYYMMDD_HH")),dateTime:null}],field=fields[0],lastModelDateTime=findClosestDateTime(moment.utc(),field.dateTimes).dateTime,$("#dateTime").html(moment.utc().format("MMM D, HH:mm")+" UTC"),setInterval(()=>{$("#dateTime").html(moment().utc().format("MMM D, HH:mm")+" UTC")},6e4),$(".btnTime").on("click",t=>{lastModelDateTime=moment(lastModelDateTime).set("hour",$(t.currentTarget).attr("id").slice(2));try{draw({init:!0})}catch(t){}}),init_btnFields(),$("#dayDown").on("click",()=>{var t=moment(lastModelDateTime).add(-1,"days");if(t>field.dateTimes[0]){var e=(lastModelDateTime=t).toDate().getUTCFullYear(),a=lastModelDateTime.toDate().getUTCMonth(),n=lastModelDateTime.toDate().getUTCDate();$(".datepicker").datepicker("setDate",new Date(e,a,n)).datepicker("update",new Date(e,a,n))}}),$("#dayUp").on("click",()=>{var t=moment(lastModelDateTime).add(1,"days");if(t<=field.dateTimes[field.dateTimes.length-1]){var e=(lastModelDateTime=t).toDate().getUTCFullYear(),a=lastModelDateTime.toDate().getUTCMonth(),n=lastModelDateTime.toDate().getUTCDate();$(".datepicker").datepicker("setDate",new Date(e,a,n)).datepicker("update",new Date(e,a,n))}}),mapWidth=parseInt($("#map").css("width")),mapHeight=parseInt($("#map").css("height")),$(".canvas").attr("width",mapWidth).attr("height",mapHeight),$("#cnvBathymetry").attr("width",mapWidth).attr("height",mapHeight),$("#cnvBG").attr("width",mapWidth).attr("height",mapHeight),$("button").popup(),getJSON("models/HYCOM/Currents/HYCOM_Currents.json",function(t){currentsMinOrg=t.varMin,currentsMaxOrg=t.varMax,resetCurrentsMinMax()}),getJSON("models/JPLMUR41/SST/JPLMUR41_SST.json",function(t){sstMinOrg=t.varMin,sstMaxOrg=t.varMax,resetSSTminMax()}),getJSON("models/CMC/SWH/CMC_SWH.json",function(t){swhMinOrg=t.varMin,swhMaxOrg=t.varMax,resetSWHminMax()}),getJSON("models/CMC/Seaice/CMC_Seaice.json",function(t){seaiceMinOrg=t.varMin,seaiceMaxOrg=t.varMax,resetSeaiceMinMax()}),$("#minUp").on("click",()=>{switch(field.field){case"SST":sstMin+1<sstMax&&(varMin=sstMin+=1);break;case"SWH":swhMin+1<swhMax&&(varMin=swhMin+=1);break;case"Seaice":seaiceMin+1<seaiceMax&&(varMin=seaiceMin+=1)}draw({init:!0}),adjustColorbar(varMin,varMax,varPalette)}),$("#minDown").on("click",()=>{switch(field.field){case"SST":sstMin-1>=sstMinOrg&&(varMin=sstMin-=1);break;case"SWH":swhMin-1>=swhMinOrg&&(varMin=swhMin-=1);break;case"Seaice":seaiceMin-1>=seaiceMinOrg&&(varMin=seaiceMin-=1)}draw({init:!0}),adjustColorbar(varMin,varMax,varPalette)}),$("#maxUp").on("click",()=>{switch(field.field){case"SST":sstMax+1<=sstMaxOrg&&(varMax=sstMax+=1);break;case"SWH":swhMax+1<=swhMaxOrg&&(varMax=swhMax+=1);break;case"Seaice":seaiceMax+1<=seaiceMaxOrg&&(varMax=seaiceMax+=1)}draw({init:!0}),adjustColorbar(varMin,varMax,varPalette)}),$("#maxDown").on("click",()=>{switch(field.field){case"SST":sstMax-1>sstMin&&(varMax=sstMax-=1);break;case"SWH":swhMax-1>swhMin&&(varMax=swhMax-=1);break;case"Seaice":seaiceMax-1>seaiceMin&&(varMax=seaiceMax-=1)}draw({init:!0}),adjustColorbar(varMin,varMax,varPalette)}),$("#btnResetMinMax").on("click",()=>{resetCurrentsMinMax(),resetSSTminMax(),resetSWHminMax(),resetSeaiceMinMax(),draw({init:!0})}),initateColorPicker(),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.WindGL=e()}(this,function(){"use strict";function t(t,e,a){var n=t.createShader(e);if(t.shaderSource(n,a),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));return n}function e(e,a,n){var r=e.createProgram(),i=t(e,e.VERTEX_SHADER,a),o=t(e,e.FRAGMENT_SHADER,n);if(e.attachShader(r,i),e.attachShader(r,o),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(r));for(var l={program:r},s=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES),d=0;d<s;d++){var c=e.getActiveAttrib(r,d);l[c.name]=e.getAttribLocation(r,c.name)}for(var m=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),u=0;u<m;u++){var h=e.getActiveUniform(r,u);l[h.name]=e.getUniformLocation(r,h.name)}return l}function a(t,e,a,n,r){var i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),a instanceof Uint8Array?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,r,0,t.RGBA,t.UNSIGNED_BYTE,a):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a),t.bindTexture(t.TEXTURE_2D,null),i}function n(t,e,a){t.activeTexture(t.TEXTURE0+a),t.bindTexture(t.TEXTURE_2D,e)}function r(t,e){var a=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),a}function i(t,e,a,n){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,n,t.FLOAT,!1,0,0)}function o(t,e,a){t.bindFramebuffer(t.FRAMEBUFFER,e),a&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0)}var l="\n    precision mediump float;\n\n\n    \n    attribute vec2 a_pos;\n\n\n    \n    varying vec2 v_tex_pos;\n\n\n    \n    void main() {\n\n        v_tex_pos = a_pos;\n\n        gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n\n    }\n\n    ",s={0:"#000000",.005:"#0099ff",.05:"#33cccc",.1:"#00ff99",.15:"#33cc33",.2:"#99ff33",.25:"#ffff00",.3:"#ff9933",.35:"#ff5050",.4:"#ff3399",.45:"#ff00ff",.5:"#9966ff"},d=function(t){this.gl=t,this.speedFactor=5,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=e(t,"\n    precision mediump float;\n\n\n    \n    attribute float a_index;\n\n\n    \n    uniform sampler2D u_particles;\n\n    uniform float u_particles_res;\n\n\n    \n    varying vec2 v_particle_pos;\n\n\n    \n    void main() {\n\n        vec4 color = texture2D(u_particles, vec2(fract(a_index / u_particles_res),floor(a_index / u_particles_res) / u_particles_res));\n\n\n        \n        // decode current particle position from the pixel's RGBA value\n\n        v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n\n        \n        gl_PointSize = 1.0;\n\n        gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n\n    }\n\n    ","\n    precision mediump float;\n\n\n    \n    uniform sampler2D u_wind;\n\n    uniform vec2 u_wind_min;\n\n    uniform vec2 u_wind_max;\n\n    uniform sampler2D u_color_ramp;\n\n\n    \n    varying vec2 v_particle_pos;\n\n\n    \n    void main() {\n\n        vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n\n        float speed_t = length(velocity) / length(u_wind_max);\n\n\n        \n        // color ramp is encoded in a 16x16 texture\n\n        vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n\n\n        gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n\n    }\n\n    "),this.screenProgram=e(t,l,"\n    precision mediump float;\n\n\n    \n    uniform sampler2D u_screen;\n\n    uniform float u_opacity;\n\n\n    \n    varying vec2 v_tex_pos;\n\n\n    \n    void main() {\n\n        vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n        // a hack to guarantee opacity fade out even with a value close to 1.0\n\n        gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n\n    }\n\n    "),this.updateProgram=e(t,l,"\n    precision highp float;\n\n\n    \n    uniform sampler2D u_particles;\n\n    uniform sampler2D u_wind;\n\n    uniform vec2 u_wind_res;\n\n    uniform vec2 u_wind_min;\n\n    uniform vec2 u_wind_max;\n\n    uniform float u_rand_seed;\n\n    uniform float u_speed_factor;\n\n    uniform float u_drop_rate;\n\n    uniform float u_drop_rate_bump;\n\n\n    \n    varying vec2 v_tex_pos;\n\n\n    \n    // pseudo-random generator\n\n    const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n\n    float rand(const vec2 co) {\n\n        float t = dot(rand_constants.xy, co);\n\n        return fract(sin(t) * (rand_constants.z + t));\n\n    }\n\n\n    \n    // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n\n    vec2 lookup_wind(const vec2 uv) {\n\n        // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n\n        vec2 px = 1.0 / u_wind_res;\n\n        vec2 vc = (floor(uv * u_wind_res)) * px;\n\n        vec2 f = fract(uv * u_wind_res);\n\n        vec2 tl = texture2D(u_wind, vc).rg;\n\n        vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n\n        vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n\n        vec2 br = texture2D(u_wind, vc + px).rg;\n\n        return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n\n    }\n\n\n    \n    void main() {\n\n        vec4 color = texture2D(u_particles, v_tex_pos);\n\n        vec2 pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n\n\n        \n        vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n\n        float speed_t = length(velocity) / length(u_wind_max);\n\n\n        \n        // take EPSG:4236 distortion into account for calculating where the particle moved\n\n        float distortion = 1.\n;\n        // cos(radians(pos.y * 180.0 - 90.0));\n\n        vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n\n        \n        // update particle position, wrapping around the date line\n\n        pos = fract(1.0 + pos + offset);\n\n\n        \n        // a random seed to use for the particle drop\n\n        vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n\n        \n        // drop rate is a chance a particle will restart at random position, to avoid degeneration\n\n        float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n\n        float drop = step(1.0 - drop_rate, rand(seed));\n\n\n        \n        vec2 random_pos = vec2( rand(seed + 1.3), rand(seed + 2.1));\n\n        pos = mix(pos, random_pos, drop);\n\n\n        \n        // encode the new particle position back into RGBA\n\n        gl_FragColor = vec4( fract(pos * 255.0), floor(pos * 255.0) / 255.0);\n\n    }\n\n    "),this.quadBuffer=r(t,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=t.createFramebuffer(),this.setColorRamp(s),this.resize()},c={numParticles:{}};return d.prototype.resize=function(){var t=this.gl,e=new Uint8Array(t.canvas.width*t.canvas.height*4);this.backgroundTexture=a(t,t.NEAREST,e,t.canvas.width,t.canvas.height),this.screenTexture=a(t,t.NEAREST,e,t.canvas.width,t.canvas.height)},d.prototype.setColorRamp=function(t){this.colorRampTexture=a(this.gl,this.gl.LINEAR,function(t){var e=document.createElement("canvas"),a=e.getContext("2d");e.width=256,e.height=1;var n=a.createLinearGradient(0,0,256,0);for(var r in t)n.addColorStop(+r,t[r]);return a.fillStyle=n,a.fillRect(0,0,256,1),new Uint8Array(a.getImageData(0,0,256,1).data)}(t),16,16)},c.numParticles.set=function(t){var e=this.gl,n=this.particleStateResolution=Math.ceil(Math.sqrt(t));this._numParticles=n*n;for(var i=new Uint8Array(4*this._numParticles),o=0;o<i.length;o++)i[o]=Math.floor(256*Math.random());this.particleStateTexture0=a(e,e.NEAREST,i,n,n),this.particleStateTexture1=a(e,e.NEAREST,i,n,n);for(var l=new Float32Array(this._numParticles),s=0;s<this._numParticles;s++)l[s]=s;this.particleIndexBuffer=r(e,l)},c.numParticles.get=function(){return this._numParticles},d.prototype.setWind=function(t){this.windData=t,this.windTexture=a(this.gl,this.gl.LINEAR,t.image)},d.prototype.draw=function(t){this.fadeOpacity=t;var e=this.gl;e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),n(e,this.windTexture,0),n(e,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles()},d.prototype.drawScreen=function(){var t=this.gl;o(t,this.framebuffer,this.screenTexture),t.viewport(0,0,t.canvas.width,t.canvas.height),this.drawTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),o(t,null),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.drawTexture(this.screenTexture,1),t.disable(t.BLEND);var e=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=e},d.prototype.drawTexture=function(t,e){var a=this.gl,r=this.screenProgram;a.useProgram(r.program),i(a,this.quadBuffer,r.a_pos,2),n(a,t,2),a.uniform1i(r.u_screen,2),a.uniform1f(r.u_opacity,e),a.drawArrays(a.TRIANGLES,0,6)},d.prototype.drawParticles=function(){var t=this.gl,e=this.drawProgram;t.useProgram(e.program),i(t,this.particleIndexBuffer,e.a_index,1),n(t,this.colorRampTexture,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1i(e.u_color_ramp,2),t.uniform1f(e.u_particles_res,this.particleStateResolution),t.uniform2f(e.u_wind_min,this.windData.varMin,this.windData.varMin),t.uniform2f(e.u_wind_max,this.windData.varMax,this.windData.varMax),t.drawArrays(t.POINTS,0,this._numParticles)},d.prototype.updateParticles=function(){var t=this.gl;o(t,this.framebuffer,this.particleStateTexture1),t.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var e=this.updateProgram;t.useProgram(e.program),i(t,this.quadBuffer,e.a_pos,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1f(e.u_rand_seed,Math.random()),t.uniform2f(e.u_wind_res,this.windData.width,this.windData.height),t.uniform2f(e.u_wind_min,this.windData.varMin,this.windData.varMin),t.uniform2f(e.u_wind_max,this.windData.varMax,this.windData.varMax),t.uniform1f(e.u_speed_factor,this.speedFactor),t.uniform1f(e.u_drop_rate,this.dropRate),t.uniform1f(e.u_drop_rate_bump,this.dropRateBump),t.drawArrays(t.TRIANGLES,0,6);var a=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=a},Object.defineProperties(d.prototype,c),d});const bathymetryMinOrg=-10850;var bathymetryMin=bathymetryMinOrg;const bathymetryMaxOrg=0;var bathymetryMax=bathymetryMaxOrg;function bathymetryInit(){$("#cnvBathymetry").css("display","block"),imgBathymetry.src="topo/bathymetry.jpg",imgBathymetry.onload=(()=>{var t=imgBathymetry.naturalHeight*(1-(lat2y(bnds._ne.lat)+lat2y(80))/(2*lat2y(80))),e=imgBathymetry.naturalHeight*(1-(lat2y(bnds._sw.lat)+lat2y(80))/(2*lat2y(80))),a=imgBathymetry.naturalWidth*(bnds._sw.lng+180)/360,n=imgBathymetry.naturalWidth*(bnds._ne.lng+180)/360-a,r=e-t;cnvBathymetryTmp.width=mapWidth,cnvBathymetryTmp.height=mapHeight,(ctxBathymetryTmp=cnvBathymetryTmp.getContext("2d")).drawImage(imgBathymetry,a,t,n,r,0,0,cnvBathymetryTmp.width,cnvBathymetryTmp.height),imageData=ctxBathymetryTmp.getImageData(0,0,mapWidth,mapHeight);const i=imageData.data;for(var o=0;o<i.length;o+=4){var l=colorPaletteBathymetry((1-50*i[o]/(bathymetryMaxOrg-bathymetryMinOrg)-(bathymetryMin-bathymetryMinOrg)/(bathymetryMaxOrg-bathymetryMinOrg))*(bathymetryMaxOrg-bathymetryMinOrg)/(bathymetryMax-bathymetryMin));i[o]=l[0],i[o+1]=l[1],i[o+2]=l[2]}ctxBathymetry.putImageData(imageData,0,0)})}function bathymetryMove(){var t=imgBathymetry.naturalHeight*(1-(lat2y(bnds._ne.lat)+lat2y(80))/(2*lat2y(80))),e=imgBathymetry.naturalHeight*(1-(lat2y(bnds._sw.lat)+lat2y(80))/(2*lat2y(80))),a=imgBathymetry.naturalWidth*(bnds._sw.lng+180)/360,n=imgBathymetry.naturalWidth*(bnds._ne.lng+180)/360-a,r=e-t;cnvBathymetryTmp.width=mapWidth,cnvBathymetryTmp.height=mapHeight,ctxBathymetryTmp.drawImage(imgBathymetry,a,t,n,r,0,0,cnvBathymetryTmp.width,cnvBathymetryTmp.height),imageData=ctxBathymetryTmp.getImageData(0,0,mapWidth,mapHeight);for(var i=imageData.data,o=0;o<i.length;o+=4){var l=colorPaletteBathymetry((1-50*i[o]/(bathymetryMaxOrg-bathymetryMinOrg)-(bathymetryMin-bathymetryMinOrg)/(bathymetryMaxOrg-bathymetryMinOrg))*(bathymetryMaxOrg-bathymetryMinOrg)/(bathymetryMax-bathymetryMin));i[o]=l[0],i[o+1]=l[1],i[o+2]=l[2]}ctxBathymetry.putImageData(imageData,0,0)}const colorsBathymetry=[[8,29,88],[8.909803921568626,29.72156862745098,89.88235294117648],[9.819607843137256,30.44313725490196,91.76470588235293],[10.729411764705882,31.16470588235294,93.6470588235294],[11.639215686274511,31.88627450980392,95.5294117647059],[12.549019607843137,32.6078431372549,97.41176470588235],[13.458823529411763,33.32941176470588,99.29411764705883],[14.368627450980393,34.05098039215686,101.1764705882353],[15.27843137254902,34.77254901960784,103.05882352941175],[16.18823529411765,35.49411764705882,104.94117647058823],[17.098039215686274,36.21568627450981,106.82352941176471],[18.00784313725493,36.937254901960806,108.70588235294123],[18.91764705882353,37.65882352941176,110.58823529411765],[19.827450980392157,38.38039215686274,112.47058823529412],[20.737254901960785,39.101960784313725,114.35294117647058],[21.647058823529413,39.8235294117647,116.23529411764707],[22.55686274509804,40.54509803921569,118.11764705882354],[23.466666666666665,41.26666666666667,120],[24.376470588235296,41.98823529411764,121.88235294117648],[25.286274509803924,42.70980392156862,123.76470588235294],[26.196078431372552,43.431372549019606,125.6470588235294],[27.105882352941176,44.15294117647059,127.5294117647059],[28.015686274509804,44.87450980392157,129.41176470588238],[28.92549019607843,45.59607843137255,131.2941176470588],[29.835294117647063,46.317647058823525,133.1764705882353],[30.745098039215687,47.03921568627451,135.0588235294118],[31.654901960784315,47.76078431372549,136.94117647058823],[32.56470588235297,48.482352941176494,138.82352941176478],[33.47450980392158,49.20392156862745,140.7058823529412],[34.3843137254902,49.925490196078435,142.58823529411765],[35.294117647058826,50.647058823529406,144.47058823529414],[36.20392156862745,51.36862745098039,146.3529411764706],[36.98823529411765,52.16470588235293,148.07843137254903],[36.89411764705883,53.482352941176465,148.7058823529412],[36.800000000000004,54.8,149.33333333333334],[36.70588235294118,56.11764705882353,149.9607843137255],[36.61176470588236,57.43529411764706,150.58823529411765],[36.51764705882353,58.75294117647059,151.21568627450984],[36.42352941176471,60.07058823529412,151.84313725490196],[36.32941176470589,61.38823529411765,152.47058823529414],[36.23529411764706,62.70588235294118,153.09803921568627],[36.14117647058824,64.0235294117647,153.72549019607845],[36.04705882352941,65.34117647058824,154.35294117647058],[35.95294117647059,66.65882352941179,154.9803921568628],[35.858823529411765,67.97647058823529,155.6078431372549],[35.76470588235294,69.29411764705881,156.23529411764707],[35.67058823529412,70.61176470588236,156.86274509803923],[35.576470588235296,71.92941176470589,157.49019607843138],[35.482352941176465,73.24705882352941,158.11764705882354],[35.38823529411765,74.56470588235295,158.7450980392157],[35.294117647058826,75.88235294117648,159.37254901960785],[35.199999999999996,77.2,160],[35.10588235294118,78.51764705882354,160.62745098039215],[35.01176470588236,79.83529411764707,161.2549019607843],[34.917647058823526,81.15294117647059,161.8823529411765],[34.8235294117647,82.47058823529413,162.50980392156862],[34.72941176470589,83.78823529411765,163.1372549019608],[34.63529411764706,85.10588235294118,163.76470588235293],[34.54117647058823,86.42352941176472,164.3921568627451],[34.44705882352941,87.74117647058829,165.01960784313727],[34.35294117647059,89.05882352941177,165.64705882352942],[34.258823529411764,90.3764705882353,166.27450980392157],[34.16470588235294,91.69411764705883,166.90196078431373],[34.07058823529412,93.01176470588236,167.52941176470588],[33.96078431372549,94.4,168.18823529411765],[33.80392156862745,96,168.94117647058823],[33.64705882352941,97.60000000000001,169.69411764705882],[33.49019607843137,99.2,170.4470588235294],[33.333333333333336,100.8,171.20000000000002],[33.17647058823529,102.4,171.95294117647057],[33.01960784313726,104,172.70588235294116],[32.86274509803921,105.6,173.45882352941177],[32.705882352941174,107.2,174.21176470588233],[32.549019607843135,108.8,174.96470588235294],[32.3921568627451,110.4,175.71764705882353],[32.23529411764705,112.00000000000006,176.47058823529414],[32.07843137254902,113.6,177.2235294117647],[31.92156862745098,115.2,177.9764705882353],[31.76470588235294,116.8,178.72941176470587],[31.6078431372549,118.39999999999999,179.48235294117646],[31.45098039215686,120,180.23529411764707],[31.294117647058822,121.6,180.98823529411763],[31.137254901960784,123.2,181.74117647058824],[30.980392156862745,124.8,182.49411764705883],[30.823529411764707,126.39999999999999,183.2470588235294],[30.666666666666668,128,184],[30.50980392156863,129.6,184.75294117647059],[30.352941176470587,131.20000000000002,185.50588235294117],[30.19607843137255,132.79999999999998,186.25882352941176],[30.03921568627451,134.4,187.01176470588237],[29.88235294117647,136,187.76470588235293],[29.72549019607843,137.60000000000005,188.51764705882357],[29.56862745098039,139.20000000000002,189.27058823529413],[29.41176470588235,140.79999999999998,190.02352941176468],[29.254901960784313,142.39999999999998,190.7764705882353],[29.098039215686274,144,191.52941176470588],[29.423529411764697,145.43529411764706,192.0470588235294],[30.552941176470583,146.59607843137252,192.17254901960783],[31.682352941176465,147.75686274509803,192.29803921568626],[32.81176470588235,148.91764705882352,192.4235294117647],[33.94117647058823,150.07843137254903,192.54901960784315],[35.07058823529411,151.23921568627452,192.67450980392158],[36.199999999999996,152.4,192.8],[37.329411764705874,153.5607843137255,192.92549019607844],[38.45882352941176,154.72156862745098,193.05098039215687],[39.588235294117645,155.88235294117646,193.1764705882353],[40.71764705882352,157.04313725490195,193.3019607843137],[41.84705882352944,158.2039215686275,193.42745098039217],[42.97647058823528,159.36470588235295,193.5529411764706],[44.105882352941165,160.52549019607844,193.67843137254903],[45.23529411764705,161.68627450980392,193.80392156862746],[46.36470588235293,162.8470588235294,193.9294117647059],[47.49411764705882,164.0078431372549,194.05490196078432],[48.6235294117647,165.16862745098038,194.18039215686275],[49.752941176470586,166.32941176470587,194.30588235294118],[50.882352941176464,167.49019607843138,194.4313725490196],[52.01176470588234,168.65098039215687,194.55686274509804],[53.14117647058823,169.81176470588235,194.68235294117648],[54.27058823529411,170.97254901960784,194.8078431372549],[55.39999999999999,172.13333333333333,194.93333333333334],[56.52941176470588,173.2941176470588,195.05882352941177],[57.658823529411755,174.4549019607843,195.1843137254902],[58.78823529411764,175.61568627450978,195.30980392156863],[59.91764705882356,176.77647058823536,195.4352941176471],[61.047058823529404,177.93725490196078,195.56078431372552],[62.17647058823529,179.09803921568627,195.68627450980395],[63.30588235294117,180.25882352941176,195.81176470588238],[64.43529411764706,181.41960784313724,195.93725490196078],[65.97254901960784,182.36078431372547,195.85882352941178],[67.91764705882353,183.08235294117648,195.5764705882353],[69.86274509803921,183.80392156862746,195.2941176470588],[71.80784313725489,184.52549019607844,195.01176470588237],[73.7529411764706,185.24705882352941,194.7294117647059],[75.69803921568631,185.96862745098042,194.4470588235294],[77.64313725490196,186.69019607843137,194.16470588235293],[79.58823529411765,187.41176470588238,193.88235294117646],[81.53333333333335,188.13333333333335,193.60000000000002],[83.47843137254901,188.85490196078433,193.31764705882352],[85.4235294117647,189.5764705882353,193.03529411764706],[87.3686274509804,190.29803921568626,192.75294117647059],[89.31372549019608,191.01960784313727,192.47058823529414],[91.25882352941179,191.74117647058824,192.18823529411765],[93.20392156862745,192.46274509803922,191.90588235294118],[95.14901960784313,193.1843137254902,191.6235294117647],[97.09411764705882,193.90588235294118,191.3411764705882],[99.03921568627452,194.62745098039215,191.05882352941177],[100.9843137254902,195.34901960784316,190.7764705882353],[102.92941176470589,196.0705882352941,190.49411764705883],[104.87450980392157,196.79215686274512,190.21176470588233],[106.81960784313729,197.5137254901961,189.92941176470586],[108.76470588235294,198.23529411764704,189.64705882352942],[110.70980392156862,198.95686274509805,189.36470588235295],[112.65490196078431,199.67843137254903,189.08235294117645],[114.6,200.4,188.79999999999998],[116.54509803921569,201.12156862745098,188.51764705882354],[118.49019607843137,201.84313725490196,188.23529411764704],[120.43529411764705,202.56470588235294,187.95294117647057],[122.38039215686278,203.28627450980395,187.6705882352941],[124.32549019607843,204.0078431372549,187.38823529411764],[126.27058823529413,204.7294117647059,187.10588235294117],[128.41176470588238,205.54901960784315,186.86274509803923],[130.67058823529413,206.42745098039217,186.64313725490194],[132.92941176470592,207.30588235294118,186.4235294117647],[135.18823529411767,208.1843137254902,186.20392156862744],[137.4470588235294,209.06274509803922,185.98431372549018],[139.70588235294122,209.94117647058826,185.76470588235293],[141.96470588235294,210.81960784313725,185.5450980392157],[144.2235294117647,211.6980392156863,185.32549019607845],[146.48235294117646,212.5764705882353,185.10588235294117],[148.74117647058824,213.4549019607843,184.8862745098039],[151,214.33333333333334,184.66666666666666],[153.25882352941176,215.21176470588236,184.4470588235294],[155.51764705882354,216.09019607843135,184.22745098039215],[157.77647058823533,216.96862745098042,184.0078431372549],[160.03529411764706,217.8470588235294,183.78823529411764],[162.29411764705884,218.72549019607843,183.5686274509804],[164.5529411764706,219.60392156862747,183.34901960784313],[166.81176470588235,220.48235294117646,183.12941176470588],[169.0705882352941,221.36078431372547,182.90980392156862],[171.3294117647059,222.23921568627452,182.6901960784314],[173.58823529411765,223.1176470588235,182.47058823529412],[175.84705882352944,223.99607843137258,182.25098039215686],[178.1058823529412,224.87450980392157,182.0313725490196],[180.36470588235295,225.75294117647059,181.81176470588235],[182.6235294117647,226.63137254901963,181.5921568627451],[184.8823529411765,227.50980392156862,181.37254901960787],[187.14117647058825,228.38823529411764,181.1529411764706],[189.4,229.26666666666668,180.93333333333334],[191.6588235294118,230.1450980392157,180.71372549019608],[193.91764705882358,231.0235294117647,180.49411764705883],[196.1764705882353,231.90196078431373,180.27450980392157],[198.43529411764706,232.78039215686275,180.05490196078435],[199.89411764705883,233.35294117647058,179.9294117647059],[201.08627450980393,233.8235294117647,179.83529411764707],[202.27843137254902,234.29411764705884,179.74117647058824],[203.47058823529412,234.76470588235293,179.64705882352942],[204.6627450980392,235.23529411764704,179.5529411764706],[205.8549019607843,235.70588235294116,179.45882352941177],[207.0470588235294,236.17647058823528,179.36470588235295],[208.23921568627452,236.64705882352942,179.27058823529413],[209.4313725490196,237.1176470588235,179.1764705882353],[210.6235294117647,237.58823529411765,179.08235294117645],[211.81568627450983,238.05882352941177,178.98823529411763],[213.0078431372549,238.52941176470586,178.8941176470588],[214.2,239,178.8],[215.39215686274508,239.47058823529412,178.7058823529412],[216.5843137254902,239.94117647058823,178.61176470588236],[217.7764705882353,240.41176470588235,178.51764705882354],[218.96862745098042,240.88235294117646,178.42352941176472],[220.16078431372551,241.35294117647058,178.3294117647059],[221.3529411764706,241.8235294117647,178.23529411764707],[222.5450980392157,242.29411764705884,178.14117647058822],[223.7372549019608,242.76470588235293,178.0470588235294],[224.9294117647059,243.23529411764707,177.95294117647057],[226.12156862745098,243.70588235294116,177.85882352941175],[227.31372549019608,244.17647058823528,177.76470588235293],[228.50588235294117,244.64705882352942,177.6705882352941],[229.69803921568626,245.1176470588235,177.57647058823528],[230.8901960784314,245.58823529411765,177.4823529411765],[232.08235294117648,246.05882352941177,177.38823529411766],[233.27450980392157,246.52941176470586,177.29411764705884],[234.46666666666667,247,177.2],[235.6588235294118,247.47058823529412,177.10588235294117],[236.85098039215686,247.94117647058823,177.01176470588234],[237.49411764705883,248.1921568627451,178.09803921568627],[238.05882352941177,248.41176470588235,179.35294117647058],[238.6235294117647,248.6313725490196,180.6078431372549],[239.18823529411765,248.85098039215686,181.8627450980392],[239.75294117647059,249.0705882352941,183.1176470588235],[240.31764705882352,249.29019607843136,184.37254901960782],[240.8823529411765,249.50980392156862,185.62745098039215],[241.4470588235294,249.72941176470587,186.88235294117646],[242.01176470588237,249.94901960784316,188.13725490196077],[242.57647058823528,250.1686274509804,189.39215686274508],[243.14117647058825,250.38823529411764,190.64705882352942],[243.70588235294116,250.6078431372549,191.90196078431373],[244.27058823529413,250.82745098039214,193.15686274509804],[244.83529411764707,251.0470588235294,194.41176470588235],[245.4,251.26666666666668,195.66666666666666],[245.96470588235294,251.48627450980393,196.921568627451],[246.52941176470588,251.70588235294116,198.17647058823528],[247.09411764705882,251.9254901960784,199.4313725490196],[247.6588235294118,252.14509803921567,200.68627450980392],[248.2235294117647,252.36470588235295,201.94117647058823],[248.78823529411767,252.5843137254902,203.19607843137254],[249.35294117647058,252.80392156862746,204.45098039215685],[249.91764705882355,253.02352941176468,205.70588235294116],[250.48235294117646,253.24313725490194,206.96078431372547],[251.04705882352943,253.46274509803922,208.21568627450978],[251.61176470588236,253.68235294117648,209.4705882352941],[252.1764705882353,253.90196078431373,210.72549019607843],[252.74117647058824,254.12156862745098,211.98039215686276],[253.30588235294118,254.3411764705882,213.23529411764707],[253.87058823529412,254.5607843137255,214.49019607843138],[254.43529411764706,254.78039215686275,215.7450980392157],[255,255,217]];function colorPaletteBathymetry(t){return t<0?colorsBathymetry[0]:t<1?colorsBathymetry[parseInt(256*t)]:colorsBathymetry[colorsBathymetry.length-1]}function adjustColorbarBathymetry(t,e,a){var n;$("#bathymetryColorbar").css("background-image",`linear-gradient(to right, ${_.range(10).map(t=>"rgb("+a(t/9)+")").join()}`),$("#lbBathymetryColorbar0").html(t>-1e3?t.toFixed(0)+" m":(t/1e3).toFixed(1)+" km"),n=.75*t+.25*e,$("#lbBathymetryColorbar25").html(n>-1e3?n.toFixed(0)+" m":(n/1e3).toFixed(1)+" km"),n=.5*t+.5*e,$("#lbBathymetryColorbar50").html(n>-1e3?n.toFixed(0)+" m":(n/1e3).toFixed(1)+" km"),n=.25*t+.75*e,$("#lbBathymetryColorbar75").html(n>-1e3?n.toFixed(0)+" m":(n/1e3).toFixed(1)+" km"),$("#lbBathymetryColorbar100").html(e<1e3?e.toFixed(0)+" m":(e/1e3).toFixed(1)+" km")}function resetBathymetryMinMax(){bathymetryMin=bathymetryMinOrg,bathymetryMax=bathymetryMaxOrg}adjustColorbarBathymetry(bathymetryMin,bathymetryMax,colorPaletteBathymetry),$("#bathymetryMinUp").on("click",()=>{bathymetryMin+50<bathymetryMax&&(bathymetryMin+=50),draw({init:!0}),adjustColorbarBathymetry(bathymetryMin,bathymetryMax,colorPaletteBathymetry)}),$("#bathymetryMinDown").on("click",()=>{bathymetryMin-50>=bathymetryMinOrg&&(bathymetryMin-=50),draw({init:!0}),adjustColorbarBathymetry(bathymetryMin,bathymetryMax,colorPaletteBathymetry)}),$("#bathymetryMaxUp").on("click",()=>{bathymetryMax+50<=bathymetryMaxOrg&&(bathymetryMax+=50),draw({init:!0}),adjustColorbarBathymetry(bathymetryMin,bathymetryMax,colorPaletteBathymetry)}),$("#bathymetryMaxDown").on("click",()=>{bathymetryMax-50>bathymetryMin&&(bathymetryMax-=50),draw({init:!0}),adjustColorbarBathymetry(bathymetryMin,bathymetryMax,colorPaletteBathymetry)}),$("#btnResetMinMaxBathymetry").on("click",()=>{resetBathymetryMinMax(),draw({init:!1})}),mapboxgl.accessToken="pk.eyJ1IjoidGFpbWF6IiwiYSI6ImNrNTlzd2h2dTA3NXgza3J6aHh2cHJlbDkifQ.iY8Kc535hXfTZ4VksOUBWg";var map=new mapboxgl.Map({container:"map",maxZoom:9,minZoom:3,zoom:4,center:[-52.71,47.56],maxBounds:[[-179.5,-79.5],[179.5,79.5]],style:"mapbox://styles/taimaz/ckg5j52mi2q0y19pe8z3dxly8?fresh=true"});function draw(t){switch(t=null==t?{init:!1}:t,bnds=map.getBounds(),cancelAnimationFrame(reqAnimID),field.field){case"Currents":currentInit();break;case"SST":case"SWH":case"Seaice":t.init?contourfInit():contourfMove()}bathymetryMove()}function clean(){ctxGL.clear(ctxGL.DEPTH_BUFFER_BIT|ctxGL.COLOR_BUFFER_BIT|ctxGL.STENCIL_BUFFER_BIT),ctxArrow.clearRect(0,0,mapWidth,mapHeight),ctxContourf.clearRect(0,0,mapWidth,mapHeight),ctxBathymetry.clearRect(0,0,mapWidth,mapHeight)}function showLatLon(t){$("#latTracker").html(num2latlon(t.lngLat.lat,"lat")),$("#lonTracker").html(num2latlon(t.lngLat.lng,"lon"))}map.dragRotate.disable(),map.touchZoomRotate.disable(),map.addControl(new mapboxgl.NavigationControl({showCompass:!1}),"bottom-right"),map.scrollZoom.setWheelZoomRate(1),map.on("load",()=>{$(".mapboxgl-ctrl-logo").remove(),$(".mapboxgl-ctrl-bottom-left").prepend('<div id="txtDepth" data-placeholder="Click anywhere for depth" style="width: 100%;color: azure;text-align-last: center;font-size: large;padding-bottom: 10px;"></div>'),map.on("move",clean).on("moveend",draw),bathymetryInit(),draw({init:!1}),map.on("mousemove",showLatLon),$("#btnMouseInfo").click()}),am4core.useTheme(am4themes_dataviz),am4core.useTheme(am4themes_animated);var chart=am4core.create("directionTracker",am4charts.GaugeChart);function createAxis(t,e,a,n,r){var i=chart.xAxes.push(new am4charts.ValueAxis);return i.min=t,i.max=e,i.strictMinMax=!0,i.renderer.useChartAngles=!0,i.renderer.startAngle=a,i.renderer.endAngle=n,i.renderer.minGridDistance=120,i.renderer.line.strokeOpacity=1,i.renderer.line.strokeWidth=2,i.renderer.line.stroke=am4core.color(r),i.renderer.labels.template.disabled=!0,i.renderer.ticks.template.disabled=!0,i.renderer.ticks.template.stroke=am4core.color(r),i.renderer.ticks.template.strokeOpacity=1,i.renderer.grid.template.disabled=!0,i.renderer.ticks.template.length=20,i}function createHand(t){var e=chart.hands.push(new am4charts.ClockHand);return e.fill=t.renderer.line.stroke,e.stroke=t.renderer.line.stroke,e.axis=t,e.pin.disabled=!0,e.startWidth=5,e.endWidth=0,e.radius=am4core.percent(90),e.innerRadius=am4core.percent(40),e.value=0,e}chart.hiddenState.properties.opacity=0,chart.startAngle=0,chart.endAngle=360;var PPfrom,PPto,PPselectedModel,PPweight,axis1=createAxis(0,360,0,360,"#EF6F6C"),hand1=createHand(axis1);function initiatePathPlanning(){_.isUndefined(PPfrom)&&(PPfrom=map.getCenter(),PPto={lng:PPfrom.lng+1,lat:PPfrom.lat+1}),$("#PPfromLat").html(num2latlon(PPfrom.lat,"lat")),$("#PPfromLon").html(num2latlon(PPfrom.lng,"lon")),$("#PPtoLat").html(num2latlon(PPto.lat,"lat")),$("#PPtoLon").html(num2latlon(PPto.lng,"lon"));try{markerFrom.remove(),markerTo.remove()}catch(t){}addMarkerFrom(PPfrom),addMarkerTo(PPto),updateDistance(),PPweight=.8,$("#inputWeight").on("slide",function(t){PPweight=t.value,$("#weightValue").text(PPweight)}),$("#inputWeight").on("change",function(t){PPweight=t.value.newValue,$("#weightValue").text(PPweight)})}function downloadGetLatLon(){window.location.href="/downloadPathPlanning"}function submitGetLatLon(){$("#btnSubmit").addClass("loading");var t={id:moment().valueOf(),fromLat:PPfrom.lat,fromLon:PPfrom.lng,toLat:PPto.lat,toLon:PPto.lng,fModel:PPselectedModel.toUpperCase(),hModel:PPselectedModel.toUpperCase(),weight:PPweight,bathymetry:$("#chkbxPPbathymetry").prop("checked")?"Y":"N",timeStepping:$("#chkbxPPtimeStepping").prop("checked")?8:1};$.ajax({url:"/pathPlanning",type:"POST",data:t,success:function(t,e,a){t.status?(addPP2Map(t.data),$("#btnDownload").removeClass("disabled")):($("#errorText").html("Please change the start and/or end point, and try again."),$("#errorModal").modal("show")),$("#btnSubmit").removeClass("loading")},error:function(t,e,a){console.log(a)}})}function addMarkerFrom(){markerFrom=new mapboxgl.Marker({draggable:!0,color:"#00cc99"}).setLngLat(PPfrom).addTo(map),markerFrom.on("drag",function(){var t=markerFrom.getLngLat();$("#PPfromLon").html(num2latlon(t.lng,"lon")),$("#PPfromLat").html(num2latlon(t.lat,"lat")),PPfrom={lng:t.lng,lat:t.lat},updateDistance()})}function addMarkerTo(){markerTo=new mapboxgl.Marker({draggable:!0,color:"#cc6699"}).setLngLat(PPto).addTo(map),markerTo.on("drag",function(){var t=markerTo.getLngLat();$("#PPtoLon").html(num2latlon(t.lng,"lon")),$("#PPtoLat").html(num2latlon(t.lat,"lat")),PPto={lng:t.lng,lat:t.lat},updateDistance()})}function moveMarkerFrom(){PPfrom={lng:inputFromLon.value,lat:inputFromLat.value},markerFrom.setLngLat(PPfrom),updateDistance()}function moveMarkerTo(){PPto={lng:inputToLon.value,lat:inputToLat.value},markerTo.setLngLat(PPto),updateDistance()}function updateDistance(){distance=turf.distance(turf.point([PPfrom.lng,PPfrom.lat]),turf.point([PPto.lng,PPto.lat]),{units:"kilometers"});var t=document.getElementById("divDistance");t.innerHTML=distance.toFixed(2)+" km",distance<=300?(t.style.color="green",PPselectedModel&&$("#btnSubmit").removeClass("disabled")):(t.style.color="red",$("#btnSubmit").addClass("disabled"))}function selectModel(t){switch(PPselectedModel=t){case"hycom":$("#btnHYCOM").addClass("active"),$("#btnRIOPS").removeClass("active"),$("#chkbxRIOPS").bootstrapToggle("off"),$("#chkbxHYCOM").bootstrapToggle("on");break;case"riops":$("#btnRIOPS").addClass("active"),$("#btnHYCOM").removeClass("active"),$("#chkbxHYCOM").bootstrapToggle("off"),$("#chkbxRIOPS").bootstrapToggle("on")}distance<1e4&&$("#btnSubmit").removeClass("disabled")}function addPP2Map(t){try{map.removeLayer("PPline"),map.removeLayer("PPcircles"),map.removeLayer("PPdistances"),map.removeSource("PPline"),map.removeSource("PPcircles"),map.removeSource("PPdistances")}catch(t){}var e=[];t.forEach(function(t){t&&(t=t.split(","),e.push([parseFloat(t[1]),parseFloat(t[0])]))});var a=d3.min(e.map(t=>t[0])),n=d3.max(e.map(t=>t[0])),r=d3.min(e.map(t=>t[1])),i=d3.max(e.map(t=>t[1])),o=n-a,l=i-r;map.fitBounds([[a-.2*o,r-.2*l],[n+.2*o,i+.2*l]]);for(var s=[],d=0;d<e.length;d++)s.push({type:"Feature",geometry:{type:"Point",coordinates:e[d]}});map.addLayer({id:"PPcircles",type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:s}},paint:{"circle-color":"white","circle-opacity":1}}),s=[];for(d=0;d<e.length-1;d++)s.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[d],e[d+1]]}});map.addLayer({id:"PPline",type:"line",source:{type:"geojson",data:{type:"FeatureCollection",features:s}},paint:{"line-color":"white"}}),s=[];for(d=0;d<e.length-1;d++){var c=180*-Math.atan((e[d][1]-e[d+1][1])/(e[d][0]-e[d+1][0]))/Math.PI,m=[.5*(e[d][0]+e[d+1][0]),.5*(e[d][1]+e[d+1][1])];s.push({type:"Feature",geometry:{type:"Point",coordinates:m},properties:{distance:turf.distance(e[d],e[d+1]).toFixed(1),angle:c,offset:[1*Math.cos(Math.atan((e[d][0]-e[d+1][0])/(e[d][1]-e[d+1][1]))),1*Math.sin(Math.atan((e[d][0]-e[d+1][0])/(e[d][1]-e[d+1][1])))]}})}map.addLayer({id:"PPdistances",type:"symbol",source:{type:"geojson",data:{type:"FeatureCollection",features:s}},layout:{"text-field":["concat",["to-string",["get","distance"]]," km"],"text-font":["Asap Bold","Arial Unicode MS Regular"],"text-rotate":["get","angle"],"text-offset":["get","offset"],"text-size":18,"text-justify":"auto"},paint:{"text-color":"rgb(180,180,180)"}})}function addMission(t){var e=readGliderData(t);mapAddLayer(t,coords2GJline(e),coords2GJpoint(e),"#ffffff"),map.fitBounds([[d3.min(e.map(t=>parseFloat(t.lon))),d3.min(e.map(t=>parseFloat(t.lat)))],[d3.max(e.map(t=>parseFloat(t.lon))),d3.max(e.map(t=>parseFloat(t.lat)))]],{padding:20}),$(`#control${t}`).css("display","inline-flex")}function removeMission(t){map.removeLayer(`${t}_line`),map.removeLayer(`${t}_points`),map.removeSource(`${t}_line`),map.removeSource(`${t}_points`),$(`#control${t}`).css("display","none")}function readGliderData(t){var e,a={path:`public/missions/${t}/${t}.csv`};return $.ajax({url:"/readCSV",type:"POST",data:a,async:!1,success:function(t,a,n){e=t.data},error:function(t,e,a){console.log(a)}}),e}function coords2GJline(t){for(var e=[],a=0;a<t.length-1;a++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[[t[a].lon,t[a].lat],[t[a+1].lon,t[a+1].lat]]},properties:{"line-width":.5+5*Math.exp(10*(a/t.length-1))}});return e}function coords2GJpoint(t){for(var e=[],a=0;a<t.length;a++)e.push({type:"Feature",geometry:{type:"Point",coordinates:[t[a].lon,t[a].lat]},properties:{radius:2+5*Math.exp(10*(a/t.length-1))}});return e}function mapAddLayer(t,e,a,n){map.addLayer({id:t+"_line",type:"line",source:{type:"geojson",data:{type:"FeatureCollection",features:e}},paint:{"line-width":["get","line-width"],"line-color":n}}),map.addLayer({id:t+"_points",type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:a},generateId:!0},paint:{"circle-radius":["case",["boolean",["feature-state","hover"],!1],["+",["get","radius"],7],["get","radius"]],"circle-stroke-color":n,"circle-color":n}})}$("svg[version='1.1']").children("g").children("g").children("g")[1].remove();var outClick=!0;function updateColor(t){var e=$(`#control${t}`).offset();$("#colorPicker").show().css("top",e.top-50).css("left",e.left+50),colorPicker.off("color:change"),colorPicker.on("color:change",(e,a)=>{e=colorPicker.color.rgbString;$(`#color${t}`).css("background",e),map.setPaintProperty(`${t}_line`,"line-color",e),map.setPaintProperty(`${t}_points`,"circle-color",e)}),outClick=!1}$(document).click(function(t){outClick&&(!$(t.target).closest("#colorPicker").length&&$("#colorPicker").is(":visible")&&$("#colorPicker").hide());outClick=!0});
